var fs=require('fs');
var path=require('path');

module.exports=replactHTML;


function replactHTML(rootPath,oldPrefix,newPrefix){
	this.rootPath=rootPath;
	this.oldPrefix=oldPrefix;
	this.newPrefix=newPrefix;

}

replactHTML.prototype.run=function(){
	var self=this;
	fs.readdir(this.rootPath,function(err,files){
		if(err){
			console.log('出现错误..'+err);
		}else{
			 files.forEach(function(fileName){
			 	var filePath=path.join(self.rootPath,fileName);
				 fs.readFile(filePath,function(err,data) {
					 if (err) {
						 console.log('出现错误..'+err);
					 } else {
						 var htmlStr = data.toString();

						 var reg=new RegExp("\\/"+self.oldPrefix,"g");

						 htmlStr=htmlStr.replace(reg,"/"+self.newPrefix);
						 fs.writeFile(filePath,htmlStr,function(err){
 							 if (err) {
									 console.log('出现错误..'+err);
								}else{
									//console.log('replace finnish...');
								}
						 })

						 // console.log(htmlStr);
					 }

				 });

			 });
		}
	})

}



